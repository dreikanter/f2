<div data-controller="token-form"  data-token-form-freefeed-hosts-value='<%= AccessToken::FREEFEED_HOSTS.to_json %>' data-token-form-default-help-url-value="https://freefeed.net">
  <%= form_with model: access_token, local: true do |form| %>
    <% if access_token.errors.any? %>
      <div class="alert alert-danger">
        <ul class="mb-0">
          <% access_token.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="mb-3">
      <%= form.label :name, class: "form-label fw-bold" %>
      <%= form.text_field :name,
                          class: "form-control #{'is-invalid' if access_token.errors[:name].any?}",
                          placeholder: "e.g., New Token (2)" %>
      <div class="form-text">Choose a descriptive name to identify this token</div>
    </div>

    <div class="mb-3">
      <%= form.label :token, token_label, class: "form-label fw-bold" %>
      <%= form.text_field :token,
                          class: "form-control #{'is-invalid' if access_token.errors[:token].any?}",
                          placeholder: token_placeholder,
                          value: token_value %>
      <div class="form-text">Get your token from your <a href="https://freefeed.net/settings/app-tokens/create?title=Feeder%20App&scopes=manage-posts,manage-groups" target="_blank" data-token-form-target="helpText">Freefeed settings</a></div>
    </div>

    <div class="mb-3">
      <%= form.label :host, "Freefeed Instance", class: "form-label fw-bold" %>
      <div class="mb-2">
        <% AccessToken::FREEFEED_HOSTS.each do |key, url| %>
          <div class="form-check mb-2">
            <%= form.radio_button :host, url,
                                  id: "host_#{key}",
                                  class: "form-check-input host-radio",
                                  checked: (access_token.host == url || (key == "production" && access_token.host.blank?)),
                                  data: { action: "change->token-form#hostChanged" } %>
            <%= form.label "host_#{key}", key.humanize, class: "form-check-label", for: "host_#{key}" %>
            <label for="host_<%= key %>" class="text-muted ms-1" style="cursor: pointer;">(<%= url %>)</label>
          </div>
        <% end %>
        <div class="form-check mb-2">
          <%= form.radio_button :host, "custom",
                                id: "host_custom",
                                class: "form-check-input host-radio",
                                checked: !AccessToken::FREEFEED_HOSTS.values.include?(access_token.host) && access_token.host.present?,
                                data: { action: "change->token-form#hostChanged" } %>
          <%= form.label :host_custom, "Custom", class: "form-check-label", for: "host_custom" %>
        </div>
      </div>
      <div id="custom-host-field" style="<%= 'display: none;' if AccessToken::FREEFEED_HOSTS.values.include?(access_token.host) || access_token.host.blank? %>" data-token-form-target="customField">
        <%= form.text_field :host,
                            class: "form-control #{'is-invalid' if access_token.errors[:host].any?}",
                            placeholder: "https://your-freefeed-instance.com",
                            id: "custom_host_input",
                            data: { token_form_target: "customInput", action: "input->token-form#customInputChanged" } %>
      </div>
      <div class="form-text">Select the Freefeed instance where your token was created</div>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
      <%= link_to "Cancel", access_tokens_path, class: "btn btn-outline-secondary" %>
      <%= form.submit submit_text, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>
