<% content_for :title, "Access Tokens" %>

<%
  access_tokens_list = ListGroupComponent.new.tap do |list|
    @access_tokens.each do |access_token|
      list.with_item(ListGroupComponent::AccessTokenItemComponent.new(
        access_token: access_token,
        key: "settings.access_tokens.#{access_token.id}"
      ))
    end
  end
%>

<div class="space-y-8">
  <%= render PageHeaderComponent.new(title: "Access Tokens") do |header| %>
    <% header.with_context_paragraph("Manage your FreeFeed API tokens used for reposting content.") %>
    <% if @access_tokens.inactive.exists? %>
      <% header.with_context_paragraph do %>
        <strong class="font-semibold">Heads up:</strong>
        Inactive tokens automatically disable associated feeds. Replace inactive tokens to re-enable your feeds.
      <% end %>
    <% end %>
    <% header.with_action_button do %>
      <%= link_to "Settings", settings_path, class: class_names("ff-button", "ff-button--secondary", "ff-button--compact") %>
    <% end %>
    <% header.with_action_button do %>
      <%= link_to "New Token", new_settings_access_token_path, class: class_names("ff-button", "ff-button--compact") %>
    <% end %>
  <% end %>

  <% if @access_tokens.any? %>
    <%= render(access_tokens_list) %>

    <% @access_tokens.each do |access_token| %>
      <%= render ConfirmationModalComponent.new(
        title: "Delete Access Token",
        action: "Delete token",
        url: settings_access_token_path(access_token),
        method: :delete,
        modal_id: "delete-token-modal-#{access_token.id}"
      ) do %>
        <div class="ff-alert ff-alert--warning space-y-2">
          <p>The token <em><%= access_token.name %></em> will be permanently removed.</p>
          <p>Any feeds using this token will be automatically disabled.</p>
          <p>This can't be undone.</p>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="ff-card">
      <div class="ff-card__body text-center">
        <h2 class="ff-h2 mb-2">No access tokens yet</h2>
        <p class="ff-text mb-6">Add a FreeFeed API access token to enable content reposting.</p>
        <%= link_to "Create New Token", new_settings_access_token_path, class: class_names("ff-button", "ff-button--compact") %>
      </div>
    </div>
  <% end %>
</div>
