<%# Partial for target group selector - dynamically updated via Turbo Stream
    Accepts:
    - feed: Feed object (new or existing)
    - groups: Array of group names (strings) or empty array
    - token: AccessToken object or nil
%>
<div id="target-group-selector">
  <div class="ff-form-group">
    <%= label_tag "feed[target_group]", "Target Group", class: "ff-form-label" %>

    <% if groups.present? %>
      <%# Success state: Enabled select dropdown with fetched groups %>
      <%= select_tag "feed[target_group]",
                     options_for_select(groups.sort, feed.target_group),
                     {
                       class: "ff-form-input",
                       required: true
                     } %>
      <p class="ff-form-help">
        The FreeFeed group where posts will be published. Groups are like channels or communities.
      </p>
    <% else %>
      <%# Error/empty state: Disabled select with error messaging %>
      <%= select_tag "feed[target_group]",
                     options_for_select([[feed.target_group.presence || "Select a group", ""]]),
                     {
                       class: "ff-form-input",
                       disabled: true
                     } %>
      <p class="ff-form-error">
        <% if token.nil? %>
          Unable to load groups. Please select a FreeFeed account.
        <% elsif !token.active? %>
          This token is inactive. Please select a different FreeFeed account or add a new one.
        <% else %>
          Could not load groups for this account.
          <%= link_to "Retry", settings_access_token_groups_path(token),
                      data: { turbo_stream: true },
                      class: "ff-link" %>
        <% end %>
      </p>
    <% end %>
  </div>
</div>
