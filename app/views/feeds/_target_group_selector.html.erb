<%# Partial for target group selector - dynamically updated via Turbo Stream
    Accepts:
    - feed: Feed object (new or existing)
    - groups: Array of group names (strings) or empty array
    - token: AccessToken object or nil
%>
<div id="target-group-selector">
  <% if groups.present? %>
    <%# Success state: Show select dropdown with fetched groups %>
    <div class="ff-form-group">
      <%= label_tag "feed[target_group]", "Target Group", class: "ff-form-label" %>
      <%= select_tag "feed[target_group]",
                     options_for_select(groups.sort, feed.target_group),
                     {
                       class: "ff-form-input",
                       required: true
                     } %>
      <p class="ff-form-help">
        The FreeFeed group where posts will be published. Groups are like channels or communities.
      </p>
    </div>
  <% else %>
    <%# Error/empty state: Show text input for manual entry %>
    <div class="ff-form-group">
      <%= label_tag "feed[target_group]", "Target Group", class: "ff-form-label" %>
      <%= text_field_tag "feed[target_group]",
                         feed.target_group,
                         {
                           class: "ff-form-input",
                           placeholder: "Enter group name",
                           required: true
                         } %>
      <p class="ff-form-help">
        <% if token.nil? %>
          Unable to load groups. Please select a FreeFeed account.
        <% elsif !token.active? %>
          This token is inactive. Please select a different FreeFeed account or add a new one.
        <% else %>
          Could not load groups for this account. Enter the group name manually.
        <% end %>
      </p>
    </div>
  <% end %>
</div>
