<div class="row">
  <div class="col-12">
    <%= page_header "Feeds" do %>
      <%= link_to "New Feed", new_feed_path, class: "btn btn-primary" %>
    <% end %>

    <% if @feeds.any? %>
      <div class="table-responsive">
        <table class="table table-hover table-bordered">
          <thead>
            <tr>
              <th>Name</th>
              <th>Status</th>
              <th>Target Group</th>
            </tr>
          </thead>
          <tbody>
            <% @feeds.each do |feed| %>
              <tr>
                <td>
                  <%= link_to feed, class: "text-decoration-none" do %>
                    <%= feed.name %>
                  <% end %>
                </td>
                <td>
                  <% if feed.enabled? %>
                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                  <% else %>
                    <i class="bi bi-x-circle-fill text-danger me-1"></i>
                  <% end %>
                  <%= feed.state.capitalize %>
                </td>
                <td>
                  <% if feed.target_group.present? %>
                    <%= feed.target_group %>
                  <% else %>
                    <em class="text-muted">None</em>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <% if pagination_total_pages > 1 %>
        <nav aria-label="Feeds pagination" class="mt-4">
          <ul class="pagination justify-content-center">
            <% if pagination_current_page > 1 %>
              <li class="page-item">
                <%= link_to "Previous", feeds_path(page: pagination_current_page - 1), class: "page-link" %>
              </li>
            <% else %>
              <li class="page-item disabled">
                <span class="page-link">Previous</span>
              </li>
            <% end %>

            <% page_start = [pagination_current_page - 2, 1].max %>
            <% page_end = [page_start + 4, pagination_total_pages].min %>
            <% page_start = [page_end - 4, 1].max if page_end - page_start < 4 %>

            <% (page_start..page_end).each do |page| %>
              <% if page == pagination_current_page %>
                <li class="page-item active">
                  <span class="page-link"><%= page %></span>
                </li>
              <% else %>
                <li class="page-item">
                  <%= link_to page, feeds_path(page: page), class: "page-link" %>
                </li>
              <% end %>
            <% end %>

            <% if pagination_current_page < pagination_total_pages %>
              <li class="page-item">
                <%= link_to "Next", feeds_path(page: pagination_current_page + 1), class: "page-link" %>
              </li>
            <% else %>
              <li class="page-item disabled">
                <span class="page-link">Next</span>
              </li>
            <% end %>
          </ul>

          <div class="text-center text-muted">
            Showing <%= @feeds.size %> of <%= pagination_total_count %> feeds
          </div>
        </nav>
      <% end %>
    <% else %>
      <div class="text-center py-5">
        <p>No feeds yet</p>
        <p class="text-muted">Create your first feed to start aggregating content.</p>
        <%= link_to "Create Feed", new_feed_path, class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
