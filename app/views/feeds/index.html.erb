<% content_for :title, "Feeds" %>

<% sort_menu_id = "feed-sort-menu" %>

<div class="space-y-8">
  <%= render PageHeaderComponent.new(title: "Feeds") do |header| %>
    <% if (summary_line = feed_summary_line(active_count: @active_feed_count, inactive_count: @inactive_feed_count)) %>
      <% header.with_context_paragraph(summary_line) %>
    <% end %>
    <% if pagination_total_count > 0 %>
      <% header.with_context_paragraph("Showing #{@feeds.size} of #{pagination_total_count} feeds") %>
    <% end %>
    <%# Sorting dropdown %>
    <% if @feeds.any? %>
      <% header.with_action_button do %>
        <div class="relative">
          <button
            id="<%= "#{sort_menu_id}-button" %>"
            type="button"
            data-dropdown-toggle="<%= sort_menu_id %>"
            data-dropdown-placement="bottom-end"
            class="<%= class_names('ff-button', 'ff-button--secondary', 'ff-button--compact', 'gap-2') %>"
            aria-haspopup="true"
            aria-expanded="false">
              <%= icon(@sortable_presenter.current_direction == "asc" ? "arrow-up-short" : "arrow-down-short", css_class: "text-slate-500", aria_hidden: true) %>
              <span class="flex items-center gap-2">
                <span><%= @sortable_presenter.current_title %></span>
                <span class="sr-only"><%= @sortable_presenter.current_direction == "asc" ? "Ascending" : "Descending" %></span>
              </span>
              <%= icon("chevron-down", css_class: "text-xs text-slate-400", aria_hidden: true) %>
          </button>
          <div
            id="<%= sort_menu_id %>"
            class="ff-dropdown-panel"
            role="menu"
            aria-labelledby="<%= "#{sort_menu_id}-button" %>">
            <ul class="py-1 text-base text-slate-600">
              <% @sortable_presenter.options.each do |option| %>
                <li>
                  <%= link_to option.path,
                              class: class_names(
                                "ff-dropdown-item",
                                "font-semibold text-slate-900": option.active?
                              ) do %>
                    <span><%= option.title %></span>
                    <% if option.icon_name.present? %>
                      <span class="flex items-center text-slate-500">
                        <%= icon(option.icon_name, css_class: "text-slate-400", aria_hidden: true) %>
                        <span class="sr-only"><%= option.active_direction == "asc" ? "Ascending" : "Descending" %></span>
                      </span>
                    <% end %>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>
    <% end %>
    <% header.with_action_button do %>
      <%= link_to "New Feed", new_feed_path, class: class_names("ff-button", "ff-button--compact", "w-full sm:w-auto") %>
    <% end %>
  <% end %>

  <% if @feeds.any? %>
    <%= render FeedsListComponent.new(feeds: @feeds) %>

    <%= pagination do |pagination_params|
      feeds_path(pagination_params)
    end %>
  <% else %>
    <div class="rounded-lg border border-dashed border-slate-300 bg-slate-50 px-6 py-12 text-center text-slate-600">
      <h2 class="text-2xl font-semibold text-slate-900">You don't have any feeds yet</h2>
      <p class="mt-2 text-sm text-slate-600">Create your first feed to start refreshing posts and sharing them with your audience.</p>
      <div class="mt-6">
        <%= link_to "Create your first feed", new_feed_path, class: class_names("ff-button", "ff-button--compact") %>
      </div>
    </div>
  <% end %>
</div>
