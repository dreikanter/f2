<% content_for :title, "Status" %>
<% content_for :body_class, "bg-white" %>

<% has_active_tokens = @user.access_tokens.active.exists? %>
<% has_feeds = @user.total_feeds_count > 0 %>

<div class="space-y-8">
  <% if @user.email_deactivated? %>
    <div class="ff-alert ff-alert--warning space-y-2" role="alert">
      <p class="ff-text ff-text--heavy">Your email address is not receiving our emails.</p>
      <% if @user.can_change_email? %>
        <p class="ff-text">
          <%= link_to "Update your email address", edit_settings_email_update_path, class: "ff-link" %>
          to continue receiving notifications.
        </p>
      <% else %>
        <p class="ff-text">You can update your email address in <%= distance_of_time_in_words(@user.time_until_email_change_allowed) %>.</p>
      <% end %>
    </div>
  <% end %>

  <% if !has_active_tokens %>
    <section class="space-y-4">
      <h1 class="text-3xl font-semibold text-slate-900">Welcome to Feeder</h1>
      <p class="ff-text">Feeder helps you automatically share content from your favorite sources to FreeFeed.</p>
      <p class="ff-text">To get started, add a FreeFeed access token so Feeder can post on your behalf.</p>
      <div>
        <%= link_to "Add FreeFeed token", new_settings_access_token_path, class: "ff-button" %>
      </div>
    </section>
  <% elsif !has_feeds %>
    <section class="space-y-4">
      <h1 class="text-3xl font-semibold text-slate-900">Welcome to Feeder</h1>
      <p class="ff-text">Great! You've added a FreeFeed access token. Now you can create your first feed.</p>
      <div>
        <%= link_to "Add feed", new_feed_path, class: "ff-button" %>
      </div>
    </section>
  <% else %>
    <section class="space-y-6">
      <h1 class="text-3xl font-semibold text-slate-900">Status</h1>
      <div class="ff-stats list-group">
        <div class="ff-stats__row list-group-item">
          <span class="ff-stats__label">Total feeds:</span>
          <span class="ff-stats__value"><%= number_with_delimiter(@user.total_feeds_count) %></span>
        </div>

        <% if @user.total_imported_posts_count > 0 %>
          <div class="ff-stats__row list-group-item">
            <span class="ff-stats__label">Total imported posts:</span>
            <span class="ff-stats__value"><%= number_with_delimiter(@user.total_imported_posts_count) %></span>
          </div>

          <div class="ff-stats__row list-group-item">
            <span class="ff-stats__label">Total published posts:</span>
            <span class="ff-stats__value"><%= number_with_delimiter(@user.total_published_posts_count) %></span>
          </div>
        <% end %>

        <% if @user.most_recent_post_published_at %>
          <div class="ff-stats__row list-group-item">
            <span class="ff-stats__label">Most recent post publication:</span>
            <span class="ff-stats__value"><%= time_ago_in_words(@user.most_recent_post_published_at) %> ago</span>
          </div>
        <% end %>

        <% if @user.total_imported_posts_count > 0 %>
          <div class="ff-stats__row list-group-item">
            <span class="ff-stats__label">Average posts per day (last week):</span>
            <span class="ff-stats__value"><%= number_with_precision(@user.average_posts_per_day_last_week, precision: 1) %></span>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>
</div>
