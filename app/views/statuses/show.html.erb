<%# locals: (recent_events:, has_active_tokens:, no_feeds:) %>

<% content_for :title, "Status" %>

<div class="space-y-8">
  <% if current_user.email_deactivated? %>
    <div class="ff-alert ff-alert--warning space-y-2" role="alert">
      <p class="ff-text ff-text--heavy">Your email address is not receiving our emails.</p>
      <% if current_user.can_change_email? %>
        <p class="ff-text">
          <%= link_to "Update your email address", edit_settings_email_update_path, class: "ff-link" %> to continue receiving notifications.
        </p>
      <% else %>
        <p class="ff-text">You can update your email address in <%= distance_of_time_in_words(current_user.time_until_email_change_allowed) %>.</p>
      <% end %>
    </div>
  <% end %>

  <% if current_user.onboarding? && !has_active_tokens %>
    <%# Onboarding - No active tokens %>
    <section class="space-y-4">
      <h1 class="ff-h1">Welcome to Feeder</h1>
      <p class="ff-text">Feeder helps you automatically share content from your favorite sources to FreeFeed.</p>
      <p class="ff-text">To get started, add a FreeFeed access token so Feeder can post on your behalf.</p>
      <div class="mt-8">
        <%= link_to "Add FreeFeed token", new_access_token_path, class: "ff-button" %>
      </div>
    </section>
  <% elsif current_user.onboarding? && has_active_tokens && no_feeds %>
    <%# Onboarding - Has token, no feeds %>
    <section class="space-y-4">
      <h1 class="ff-h1">Welcome to Feeder</h1>
      <p class="ff-text">Great! You've added a FreeFeed access token. Now you can create your first feed.</p>
      <div class="mt-8">
        <%= link_to "Add feed", new_feed_path, class: "ff-button" %>
      </div>
    </section>
  <% else %>
    <%# Active user %>
    <h1 class="ff-h1">Status</h1>

    <% if current_user.active? && !has_active_tokens %>
      <%# Active user with no active tokens %>
      <div class="ff-alert ff-alert--warning space-y-2" role="alert">
        <p class="ff-text ff-text--heavy">You don't have any active FreeFeed tokens.</p>
        <p class="ff-text">
          <%= link_to "Add a token", new_access_token_path, class: "ff-link" %> to resume posting.
        </p>
      </div>
    <% end %>

    <%= render UserStatsComponent.new(user: current_user) %>

    <% if recent_events.any? %>
      <section class="space-y-4">
        <h2 class="ff-h2">Recent Activity</h2>
        <%= render RecentEventsComponent.new(events: recent_events) %>
      </section>
    <% end %>
  <% end %>
</div>
