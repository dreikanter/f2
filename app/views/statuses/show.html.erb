<% content_for :title, "Status" %>

<% has_active_tokens = @user.access_tokens.active.exists? %>
<% has_feeds = @user.total_feeds_count > 0 %>

<% if !has_active_tokens %>
  <%= page_header "Welcome to Feeder" %>

  <div class="row">
    <div class="col-12">
      <p>
        Feeder helps you automatically share content from your favorite sources to FreeFeed.
      </p>
      <p>
        To get started, you'll need to add a FreeFeed access token so Feeder can post on your behalf.
      </p>
      <p>
        <%= link_to "Add FreeFeed token", new_settings_access_token_path, class: "btn btn-primary" %>
      </p>
    </div>
  </div>
<% elsif !has_feeds %>
  <%= page_header "Welcome to Feeder" %>

  <div class="row">
    <div class="col-12">
      <p>
        Great! You've added a FreeFeed access token. Now you can create your first feed.
      </p>
      <p>
        <%= link_to "Add feed", new_feed_path, class: "btn btn-primary" %>
      </p>
    </div>
  </div>
<% else %>
  <%= page_header "Status" %>

  <div class="row">
    <div class="col-12">
      <div class="list-group">
        <div class="list-group-item">
          <strong>Total feeds:</strong>
          <%= number_with_delimiter(@user.total_feeds_count) %>
        </div>

        <% if @user.total_imported_posts_count > 0 %>
          <div class="list-group-item">
            <strong>Total imported posts:</strong>
            <%= number_with_delimiter(@user.total_imported_posts_count) %>
          </div>

          <div class="list-group-item">
            <strong>Total published posts:</strong>
            <%= number_with_delimiter(@user.total_published_posts_count) %>
          </div>
        <% end %>

        <% if @user.most_recent_post_published_at %>
          <div class="list-group-item">
            <strong>Most recent post publication:</strong>
            <%= time_ago_in_words(@user.most_recent_post_published_at) %> ago
          </div>
        <% end %>

        <% if @user.total_imported_posts_count > 0 %>
          <div class="list-group-item">
            <strong>Average posts per day (last week):</strong>
            <%= number_with_precision(@user.average_posts_per_day_last_week, precision: 1) %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
