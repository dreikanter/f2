<% content_for :title, "Status" %>

<% has_active_tokens = @user.access_tokens.active.exists? %>
<% has_feeds = @user.total_feeds_count > 0 %>

<div class="space-y-8">
  <% if @user.email_deactivated? %>
    <div class="ff-alert ff-alert--warning space-y-2" role="alert">
      <p class="ff-text ff-text--heavy">Your email address is not receiving our emails.</p>
      <% if @user.can_change_email? %>
        <p class="ff-text">
          <%= link_to "Update your email address", edit_settings_email_update_path, class: "ff-link" %>
          to continue receiving notifications.
        </p>
      <% else %>
        <p class="ff-text">You can update your email address in <%= distance_of_time_in_words(@user.time_until_email_change_allowed) %>.</p>
      <% end %>
    </div>
  <% end %>

  <% if !has_active_tokens %>
    <section class="space-y-4">
      <h1 class="ff-h1">Welcome to Feeder</h1>
      <p class="ff-text">Feeder helps you automatically share content from your favorite sources to FreeFeed.</p>
      <p class="ff-text">To get started, add a FreeFeed access token so Feeder can post on your behalf.</p>
      <div>
        <%= link_to "Add FreeFeed token", new_settings_access_token_path, class: "ff-button" %>
      </div>
    </section>
  <% elsif !has_feeds %>
    <section class="space-y-4">
      <h1 class="ff-h1">Welcome to Feeder</h1>
      <p class="ff-text">Great! You've added a FreeFeed access token. Now you can create your first feed.</p>
      <div>
        <%= link_to "Add feed", new_feed_path, class: "ff-button" %>
      </div>
    </section>
  <% else %>
    <h1 class="ff-h1">Status</h1>
    <%= render StatusStatsComponent.new(
      total_feeds_count: @user.total_feeds_count,
      total_imported_posts_count: @user.total_imported_posts_count,
      total_published_posts_count: @user.total_published_posts_count,
      most_recent_post_published_at: @user.most_recent_post_published_at,
      average_posts_per_day_last_week: @user.average_posts_per_day_last_week
    ) %>

    <%= render PostsHeatmapComponent.new(user: @user) %>

    <% if @recent_events.any? %>
      <section class="space-y-4">
        <h2 class="ff-h2">Recent Events</h2>
        <%= render RecentEventsComponent.new(events: @recent_events) %>
      </section>
    <% end %>
  <% end %>
</div>
