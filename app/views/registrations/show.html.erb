<% content_for :title, "Register" %>

<div class="mx-auto w-full max-w-2xl space-y-6">
  <% if @invite.nil? %>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body space-y-4">
        <h1 class="card-title text-3xl font-semibold">This invite link doesn't look right</h1>
        <p>We couldn't find an invitation with that code. It might have been removed or copied incorrectly.</p>

        <div class="space-y-2">
          <p class="font-semibold text-base-content">Already have an account?</p>
          <p><%= link_to "Sign in", new_session_path, class: "app-link" %> with your email and password.</p>
        </div>

        <div class="space-y-2">
          <p class="font-semibold text-base-content">Need an invitation?</p>
          <p>Ask someone who already uses Feeder to send you a new link.</p>
        </div>
      </div>
    </div>
  <% elsif @invite.used? %>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body space-y-4">
        <h1 class="card-title text-3xl font-semibold">This invite was already used</h1>
        <p>This link has already been used to create an account.</p>

        <div class="space-y-2">
          <p class="font-semibold text-base-content">Already have an account?</p>
          <ul class="list-disc space-y-1 ps-5 text-lg text-base-content/80">
            <li>
              Forgot your password? <%= link_to "Reset it here", new_password_path, class: "app-link" %>.
            </li>
            <li>
              Otherwise, <%= link_to "sign in", new_session_path, class: "app-link" %> with your email and password.
            </li>
          </ul>
        </div>

        <div class="space-y-2">
          <p class="font-semibold text-base-content">Need a fresh invitation?</p>
          <p>Ask the person who sent this link to share a new one.</p>
        </div>
      </div>
    </div>
  <% else %>
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body space-y-6">
        <div class="space-y-3">
          <h1 class="card-title text-3xl font-semibold">Create your account</h1>
          <div class="alert alert-info alert-soft" role="alert">
            <span>
              <%= @invite.created_by_user.name.presence || "Somebody" %> invited you to join Feeder.
            </span>
          </div>
        </div>

        <%= form_with model: @user, url: registration_path(code: params[:code]), method: :post, local: true do |form| %>
          <div class="space-y-4">
            <% if @user.errors.any? %>
              <div class="alert alert-error" role="alert">
                <span><%= @user.errors.full_messages.to_sentence.capitalize %></span>
              </div>
            <% end %>

            <div class="space-y-2">
              <%= form.label :name, class: "block text-sm font-semibold text-base-content" %>
              <%= form.text_field :name, class: "input input-lg app-input shadow-sm", autofocus: true, required: true %>
              <p class="text-xs text-base-content/70">You can change this anytime.</p>
            </div>

            <div class="space-y-2">
              <%= form.label :email_address, "Email", class: "block text-sm font-semibold text-base-content" %>
              <%= form.email_field :email_address, class: "input input-lg app-input shadow-sm", required: true %>
              <p class="text-xs text-base-content/70">Only used for password resetsâ€”we don't send marketing emails.</p>
            </div>

            <div class="space-y-2">
              <%= form.label :password, class: "block text-sm font-semibold text-base-content" %>
              <%= form.password_field :password, class: "input input-lg app-input shadow-sm", required: true %>
              <p class="text-xs text-base-content/70">Choose at least <%= User::PASSWORD_MIN_LENGTH %> characters to keep things secure.</p>
            </div>
          </div>

          <div class="card-actions mt-6 flex-wrap justify-between gap-3 text-sm text-base-content/80">
            <span class="text-sm text-base-content/80">
              Already use Feeder?
              <%= link_to "Sign in", new_session_path, class: "app-link" %>
            </span>
            <%= form.submit "Create account", class: "btn btn-primary btn-lg shadow-md" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
