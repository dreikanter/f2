<% content_for :title, "Register" %>
<% content_for :body_class, "sm:bg-slate-100" %>

<div class="mx-auto w-full max-w-full space-y-6 sm:max-w-2xl sm:px-0 px-4" data-controller="autofocus">
  <% if @invite.nil? %>
    <div class="ff-card">
      <div class="ff-card__body">
        <h1 class="ff-card__title">This invite link doesn't look right</h1>
        <p class="ff-text">We couldn't find an invitation with that code. It might have been removed or copied incorrectly.</p>

        <div class="space-y-2">
          <p class="ff-text ff-text--heavy">Already have an account?</p>
          <p class="ff-text">
            <%= link_to "Sign in", new_session_path, class: "ff-link" %>
            with your email and password.
          </p>
        </div>

        <div class="space-y-2">
          <p class="ff-text ff-text--heavy">Need an invitation?</p>
          <p class="ff-text">Ask someone who already uses Feeder to send you a new link.</p>
        </div>
      </div>
    </div>
  <% elsif @invite.used? %>
    <div class="ff-card">
      <div class="ff-card__body">
        <h1 class="ff-card__title">This invite was already used</h1>
        <p class="ff-text">This link has already been used to create an account.</p>

        <div class="space-y-4">
          <p class="ff-text ff-text--heavy">Already have an account?</p>
          <ul class="list-disc space-y-1 ps-5 text-slate-600">
            <li>
              Forgot your password?
              <%= link_to "Reset it here", new_password_path, class: "ff-link" %>.
            </li>
            <li>
              Otherwise,
              <%= link_to "sign in", new_session_path, class: "ff-link" %>
              with your email and password.
            </li>
          </ul>
        </div>

        <div class="space-y-4">
          <p class="ff-text ff-text--heavy">Need a fresh invitation?</p>
          <p class="ff-text">Ask the person who sent this link to share a new one.</p>
        </div>
      </div>
    </div>
  <% else %>
    <div class="ff-card">
      <div class="ff-card__body">
        <div class="space-y-4">
          <h1 class="ff-card__title">Create your account</h1>
          <% if @invite&.created_by_user %>
            <p class="ff-text">
              <%= @invite.created_by_user.name.presence || "Somebody" %> invited you to join Feeder.
            </p>
          <% end %>
        </div>
        <% @user ||= User.new %>
        <%= form_with model: @user, url: registration_path(code: params[:code]), method: :post, local: true do |form| %>
          <div class="space-y-6">
            <% if @user.errors.any? %>
              <div class="ff-alert ff-alert--error" role="alert">
                <span><%= @user.errors.full_messages.to_sentence.capitalize %></span>
              </div>
            <% end %>

            <div class="ff-form-group">
              <%= form.label :email_address, "Email", class: "ff-form-label" %>
              <%= form.email_field :email_address, class: "ff-form-input", required: true, autofocus: true %>
              <p class="ff-form-help">Only used for password resetsâ€”we don't send marketing emails.</p>
            </div>

            <div class="ff-form-group">
              <%= form.label :password, class: "ff-form-label" %>
              <%= form.password_field :password, class: "ff-form-input", required: true %>
              <p class="ff-form-help">Choose at least <%= User::PASSWORD_MIN_LENGTH %> characters to keep things secure.</p>
            </div>
          </div>
          <div class="ff-card__footer flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <%= form.submit "Create account", class: "ff-button w-full sm:w-auto" %>
            <span class="text-slate-600">
              Already use Feeder?
              <%= link_to "Sign in", new_session_path, class: "ff-link" %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
