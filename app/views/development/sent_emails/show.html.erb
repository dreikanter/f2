<% content_for :title, h(@email[:subject]) %>

<div class="space-y-8">
  <div class="flex items-center justify-between">
    <h1 class="ff-h1 text-3xl" data-key="development.emails.subject"><%= h @email[:subject] %></h1>
    <%= link_to "Back to all emails",
                development_sent_emails_path,
                class: class_names("ff-button", "ff-button--secondary", "ff-button--compact") %>
  </div>

  <% email_details = ListGroupComponent.new.tap do |list|
       list.with_item(ListGroupComponent::StatItemComponent.new(
         label: "Message ID",
         value: content_tag(:code, @email[:message_id], class: "text-xs break-all")
       ))

       list.with_item(ListGroupComponent::StatItemComponent.new(
         label: "From",
         value: content_tag(:code, @email[:from], class: "text-xs break-words")
       ))

       list.with_item(ListGroupComponent::StatItemComponent.new(
         label: "To",
         value: content_tag(:code, @email[:to], class: "text-xs break-words")
       ))

       list.with_item(ListGroupComponent::StatItemComponent.new(
         label: "Date",
         value: content_tag(:span, @email[:date], class: "text-sm text-slate-700")
       ))
     end %>

  <%= render(email_details) %>

  <% if @email[:multipart] %>
    <div data-controller="email-viewer" class="space-y-4">
      <div class="border-b border-slate-200">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" role="tablist">
          <li class="mr-2" role="presentation">
            <button
              type="button"
              class="inline-block rounded-t-lg border-b-2 px-4 py-2 text-cyan-600 border-cyan-600"
              data-action="email-viewer#showText"
              data-email-viewer-target="textTab"
              data-key="development.emails.tab.text">
              Text
            </button>
          </li>
          <li class="mr-2" role="presentation">
            <button
              type="button"
              class="inline-block rounded-t-lg border-b-2 border-transparent px-4 py-2 text-slate-500 hover:text-slate-600"
              data-action="email-viewer#showHtml"
              data-email-viewer-target="htmlTab"
              data-key="development.emails.tab.html">
              HTML
            </button>
          </li>
        </ul>
      </div>
      <div class="rounded-lg border border-slate-200 bg-slate-50 p-4" data-email-viewer-target="textPanel">
        <pre class="mb-0 whitespace-pre-wrap text-sm text-slate-700" data-key="development.emails.text-part"><%= h @email[:text_part] %></pre>
      </div>
      <div class="hidden rounded-lg border border-slate-200 bg-white" data-email-viewer-target="htmlPanel">
        <iframe srcdoc="<%= ERB::Util.html_escape(@email[:html_part]) %>" sandbox title="Email HTML preview" referrerpolicy="no-referrer" class="h-[400px] w-full rounded-lg"></iframe>
      </div>
    </div>
  <% else %>
    <div class="rounded-lg border border-slate-200 bg-slate-50 p-4">
      <pre class="mb-0 whitespace-pre-wrap text-sm text-slate-700" data-key="development.emails.body"><%= h @email[:body] %></pre>
    </div>
  <% end %>
</div>
