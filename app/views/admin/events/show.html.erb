<% content_for :title, "Event ##{@event.id}" %>

<%= page_header "Event ##{@event.id}" do %>
  <div class="d-flex gap-2">
    <% if @previous_event %>
      <%= link_to "← Previous", admin_event_path(@previous_event), class: "btn btn-outline-secondary" %>
    <% else %>
      <span class="btn btn-outline-secondary disabled">← Previous</span>
    <% end %>

    <% if @next_event %>
      <%= link_to "Next →", admin_event_path(@next_event), class: "btn btn-outline-secondary" %>
    <% else %>
      <span class="btn btn-outline-secondary disabled">Next →</span>
    <% end %>

    <%= link_to "Back to Events", admin_events_path, class: "btn btn-outline-primary" %>
  </div>
<% end %>

<% if @event.message.present? %>
  <div class="alert alert-<%= @event.level == 'error' ? 'danger' : @event.level == 'warning' ? 'warning' : 'info' %> mb-4">
    <%= simple_format(@event.message, class: "mb-0") %>
  </div>
<% end %>

<div class="list-group">
  <div class="list-group-item">
    <strong>Type:</strong>
    <code><%= @event.type %></code>
  </div>

  <div class="list-group-item">
    <strong>Level:</strong>
    <%= @event.level.capitalize %>
  </div>

  <div class="list-group-item">
    <strong>User:</strong>
    <% if @event.user %>
      <%= @event.user.email_address %>
    <% else %>
      <em class="text-muted">System</em>
    <% end %>
  </div>

  <div class="list-group-item">
    <strong>Subject:</strong>
    <% if @event.subject %>
      <% if @event.subject_type == "Feed" %>
        <%= link_to @event.subject_type, feed_path(@event.subject) %>
      <% elsif @event.subject_type == "Post" %>
        <%= link_to @event.subject_type, post_path(@event.subject) %>
      <% else %>
        <%= @event.subject_type %>
      <% end %>
      <span class="text-muted">#<%= @event.subject_id %></span>
    <% else %>
      <em class="text-muted">None</em>
    <% end %>
  </div>

  <div class="list-group-item">
    <strong>Created:</strong>
    <%= long_time_tag(@event.created_at) %>
    <span class="text-muted">(<%= short_time_ago(@event.created_at) %>)</span>
  </div>

  <div class="list-group-item">
    <strong>Updated:</strong>
    <%= long_time_tag(@event.updated_at) %>
    <span class="text-muted">(<%= short_time_ago(@event.updated_at) %>)</span>
  </div>

  <% if @event.expires_at %>
    <div class="list-group-item">
      <strong>Expires:</strong>
      <%= long_time_tag(@event.expires_at) %>
      <% if @event.expired? %>
        <span class="badge bg-danger">Expired</span>
      <% else %>
        <span class="text-muted">(in <%= short_time_ago(@event.expires_at) %>)</span>
      <% end %>
    </div>
  <% end %>
</div>

<% if @event.metadata.present? && @event.metadata != {} %>
  <div class="mt-4">
    <h3 class="mb-3">Metadata</h3>
    <pre class="font-monospace small bg-light border rounded p-3 mb-0 overflow-auto"><%= highlight_json(@event.metadata).html_safe %></pre>
  </div>
<% end %>
