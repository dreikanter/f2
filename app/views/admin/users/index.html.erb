<%= page_header "Users" %>

<% if @users.any? %>
  <div class="table-responsive">
    <table class="table table-hover table-bordered text-nowrap">
      <thead>
        <tr>
          <th>Email</th>
          <th class="text-center">Feeds</th>
          <th class="text-center">Tokens</th>
          <th class="text-center">Posts</th>
          <th class="text-center">Last Seen</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td>
              <%= link_to user.email_address, admin_user_path(user) %>
              <% if user.admin? %>
                <span class="text-muted">(admin)</span>
              <% end %>
            </td>
            <td class="text-center">
              <%= user.feeds.count %>
            </td>
            <td class="text-center">
              <%= user.access_tokens.count %>
            </td>
            <td class="text-center">
              <%= Post.joins(:feed).where(feeds: { user_id: user.id }).count %>
            </td>
            <td class="text-center">
              <% last_session = user.sessions.order(updated_at: :desc).first %>
              <span class="text-muted">
                <%= last_session ? short_time_ago(last_session.updated_at) : "Never" %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= pagination_for @users,
                     collection_name: "users",
                     path_helper: ->(page) { admin_users_path(page: page) } %>
<% else %>
  <div class="text-center py-5">
    <p class="text-muted">No users found</p>
  </div>
<% end %>

