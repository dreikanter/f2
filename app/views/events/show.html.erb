<% content_for :title, "Event ##{@event.id}" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Event #<%= @event.id %></h1>
  <div class="d-flex gap-2">
    <% if @previous_event %>
      <%= link_to "← Previous", event_path(@previous_event), class: "btn btn-outline-secondary" %>
    <% else %>
      <span class="btn btn-outline-secondary disabled">← Previous</span>
    <% end %>
    
    <% if @next_event %>
      <%= link_to "Next →", event_path(@next_event), class: "btn btn-outline-secondary" %>
    <% else %>
      <span class="btn btn-outline-secondary disabled">Next →</span>
    <% end %>
    
    <%= link_to "Back to Events", events_path, class: "btn btn-outline-primary" %>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="card-title mb-0">Event Details</h5>
  </div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-lg-2 col-md-3">Type</dt>
      <dd class="col-lg-4 col-md-9">
        <code class="text-dark fs-6"><%= @event.type %></code>
      </dd>

      <dt class="col-lg-2 col-md-3">Level</dt>
      <dd class="col-lg-4 col-md-9 text-uppercase">
        <%= level_badge_full(@event.level) %>
      </dd>

      <dt class="col-lg-2 col-md-3">User</dt>
      <dd class="col-lg-4 col-md-9">
        <% if @event.user %>
          <%= @event.user.email_address %>
        <% else %>
          <em class="text-muted">System</em>
        <% end %>
      </dd>

      <dt class="col-lg-2 col-md-3">Subject</dt>
      <dd class="col-lg-4 col-md-9">
        <% if @event.subject %>
          <span class="text-muted"><%= @event.subject_type %></span>
          <span class="text-primary">#<%= @event.subject_id %></span>
        <% else %>
          <em class="text-muted">None</em>
        <% end %>
      </dd>

      <dt class="col-lg-2 col-md-3">Created</dt>
      <dd class="col-lg-4 col-md-9">
        <%= @event.created_at.strftime("%B %d, %Y at %I:%M %p %Z") %>
        <br>
        <small class="text-muted">
          <%= compact_time_ago(@event.created_at) %>
        </small>
      </dd>

      <dt class="col-lg-2 col-md-3">Updated</dt>
      <dd class="col-lg-4 col-md-9">
        <%= @event.updated_at.strftime("%B %d, %Y at %I:%M %p %Z") %>
        <br>
        <small class="text-muted">
          <%= compact_time_ago(@event.updated_at) %>
        </small>
      </dd>

      <% if @event.expires_at %>
        <dt class="col-lg-2 col-md-3">Expires</dt>
        <dd class="col-lg-10 col-md-9">
          <%= @event.expires_at.strftime("%B %d, %Y at %I:%M %p %Z") %>
          <br>
          <% if @event.expired? %>
            <span class="badge bg-danger">Expired</span>
          <% else %>
            <small class="text-muted">
              Expires in <%= compact_time_ago(@event.expires_at) %>
            </small>
          <% end %>
        </dd>
      <% end %>

      <dt class="col-12">Message</dt>
      <dd class="col-12">
        <% if @event.message.present? %>
          <%= simple_format(@event.message, class: "mb-0") %>
        <% else %>
          <em class="text-muted">No message</em>
        <% end %>
      </dd>
    </dl>
  </div>
</div>

<% if @event.metadata.present? && @event.metadata != {} %>
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">Metadata</h5>
    </div>
    <div class="card-body">
      <pre class="event-metadata font-monospace small bg-light border rounded p-3 mb-0 overflow-auto"><code><%= JSON.pretty_generate(@event.metadata) %></code></pre>
    </div>
  </div>
<% end %>
