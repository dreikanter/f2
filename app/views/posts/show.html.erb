<% content_for :title, "Post Details" %>

<%= page_header "Post Details" do %>
  <%= link_to "← Back to Posts", posts_path, class: "btn btn-outline-secondary" %>
<% end %>

<div class="row">
  <div class="col-12">
    <div class="list-group">
      <div class="list-group-item">
        <strong>Feed:</strong>
        <%= link_to @post.feed.name, @post.feed, class: "text-decoration-none" %>
      </div>

      <div class="list-group-item">
        <strong>Content:</strong>
        <div class="mt-2">
          <div class="p-3 border rounded bg-light">
            <%= simple_format(@post.content) %>
          </div>
        </div>
      </div>

      <div class="list-group-item">
        <strong>Published At:</strong>
        <%= @post.published_at.strftime("%B %d, %Y at %H:%M") if @post.published_at %>
      </div>

      <div class="list-group-item">
        <strong>Status:</strong>
        <% case @post.status %>
        <% when "published" %>
          <span class="badge bg-success">Published</span>
        <% when "failed" %>
          <span class="badge bg-danger">Failed</span>
        <% when "enqueued" %>
          <span class="badge bg-warning">Enqueued</span>
        <% when "rejected" %>
          <span class="badge bg-secondary">Rejected</span>
        <% else %>
          <span class="badge bg-light text-dark"><%= @post.status.capitalize %></span>
        <% end %>
      </div>

      <% if @post.attachment_urls.present? %>
        <div class="list-group-item">
          <strong>Attachments (<%= @post.attachment_urls.length %>):</strong>
          <div class="mt-2">
            <% @post.attachment_urls.each_with_index do |url, index| %>
              <div class="mb-2">
                <%= link_to "Attachment #{index + 1}", url,
                            class: "btn btn-sm btn-outline-info",
                            target: "_blank",
                            rel: "noopener" %>
                <small class="text-muted ms-2"><%= url %></small>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if @post.comments.present? %>
        <div class="list-group-item">
          <strong>Comments (<%= @post.comments.length %>):</strong>
          <div class="mt-2">
            <% @post.comments.each_with_index do |comment, index| %>
              <div class="border-start border-3 border-secondary ps-3 mb-3">
                <div class="small text-muted mb-1">Comment <%= index + 1 %></div>
                <div><%= simple_format(comment) %></div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="list-group-item">
        <strong>External Links:</strong>
        <div class="mt-2">
          <% if @post.freefeed_post_id.present? %>
            <%= link_to "View on FreeFeed", "https://freefeed.net/#{@post.feed.target_group}/#{@post.freefeed_post_id}",
                        class: "btn btn-outline-primary me-2",
                        target: "_blank",
                        rel: "noopener" %>
          <% end %>
          <% if @post.source_url.present? %>
            <%= link_to "View Original Source", @post.source_url,
                        class: "btn btn-outline-secondary",
                        target: "_blank",
                        rel: "noopener" %>
          <% end %>
          <% unless @post.freefeed_post_id.present? || @post.source_url.present? %>
            <em class="text-muted">No external links available</em>
          <% end %>
        </div>
      </div>

      <% if @post.validation_errors.present? %>
        <div class="list-group-item">
          <strong>Validation Errors:</strong>
          <div class="mt-2">
            <div class="alert alert-danger">
              <% if @post.validation_errors.is_a?(Array) %>
                <ul class="mb-0">
                  <% @post.validation_errors.each do |error| %>
                    <li><%= error %></li>
                  <% end %>
                </ul>
              <% else %>
                <%= @post.validation_errors %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <div class="list-group-item">
        <strong>Technical Details:</strong>
        <div class="mt-2">
          <div class="row">
            <div class="col-md-6">
              <small class="text-muted">Post ID:</small> <code><%= @post.id %></code><br>
              <small class="text-muted">UID:</small> <code><%= @post.uid %></code><br>
              <small class="text-muted">Feed Entry ID:</small> <code><%= @post.feed_entry_id %></code>
            </div>
            <div class="col-md-6">
              <small class="text-muted">Created:</small> <%= @post.created_at.strftime("%B %d, %Y at %H:%M") %><br>
              <small class="text-muted">Updated:</small> <%= @post.updated_at.strftime("%B %d, %Y at %H:%M") %><br>
              <% if @post.freefeed_post_id.present? %>
                <small class="text-muted">FreeFeed Post ID:</small> <code><%= @post.freefeed_post_id %></code>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>