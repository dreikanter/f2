<% if feed_preview.posts_data.any? %>
  <div class="alert alert-info" role="alert">
    Showing <%= feed_preview.posts_count %> most recent <%= "post".pluralize(feed_preview.posts_count) %>.
  </div>

  <% feed_preview.posts_data.each_with_index do |post_data, index| %>
    <div class="card mb-3">
      <div class="card-header">
        <h6 class="card-title mb-0">Post <%= index + 1 %></h6>
      </div>
      <div class="card-body">
        <% if post_data['uid'].present? %>
          <div class="mb-2">
            <strong>UID:</strong> <%= post_data['uid'] %>
          </div>
        <% end %>

        <% if post_data['published_at'].present? %>
          <div class="mb-2">
            <strong>Published:</strong>
            <%= Time.parse(post_data['published_at']).to_fs(:long) rescue post_data['published_at'] %>
          </div>
        <% end %>

        <% if post_data['source_url'].present? %>
          <div class="mb-2">
            <strong>Source:</strong>
            <a href="<%= post_data['source_url'] %>" target="_blank" class="text-decoration-none">
              <%= post_data['source_url'] %>
            </a>
          </div>
        <% end %>

        <div class="mb-2">
          <strong>Content:</strong>
          <div class="mt-1">
            <%= simple_format(post_data['content']) %>
          </div>
        </div>

        <% if post_data['attachments'].present? && post_data['attachments'].any? %>
          <div class="mb-0">
            <strong>Attachments:</strong>
            <ul class="list-unstyled ms-3">
              <% post_data['attachments'].each do |attachment| %>
                <li>
                  <% if attachment.is_a?(Hash) && attachment['url'] %>
                    <a href="<%= attachment['url'] %>" target="_blank" class="text-decoration-none">
                      <%= attachment['url'] %>
                    </a>
                    <% if attachment['type'] %>
                      <small class="text-muted">(<%= attachment['type'] %>)</small>
                    <% end %>
                  <% elsif attachment.present? %>
                    <a href="<%= attachment %>" target="_blank" class="text-decoration-none">
                      <%= attachment %>
                    </a>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% else %>
  <div class="alert alert-light" role="alert">
    No posts found in this feed.
  </div>
<% end %>
