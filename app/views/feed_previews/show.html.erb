<% content_for :title, "Feed Preview" %>

<div class="flex flex-col gap-3 mb-4 sm:flex-row sm:items-start sm:justify-between">
  <div>
    <h1 class="ff-h1">Feed Preview</h1>
    <p class="ff-text mt-2">
      Source URL: <a href="<%= @feed_preview.url %>" target="_blank" rel="noopener" class="ff-link break-all"><%= @feed_preview.url %></a> (<%= t("feed_profiles.#{@feed_preview.feed_profile_key}") %>)
    </p>
  </div>
  <div id="header-actions" class="flex w-full items-center justify-between gap-5 sm:w-auto sm:justify-end">
    <%= render "feed_previews/header_actions", feed_preview: @feed_preview %>
  </div>
</div>

<div
  id="preview-status"
  class="space-y-6"
  aria-busy="<%= @feed_preview.pending? || @feed_preview.processing? %>"
  <% if @feed_preview.pending? || @feed_preview.processing? %>
    data-controller="polling"
    data-polling-endpoint-value="<%= feed_preview_path(@feed_preview, format: :turbo_stream) %>"
    data-polling-stop-condition-value="[data-feed-preview-spinner]"
  <% end %>>
  <% if @feed_preview.ready? %>
    <%= render "feed_previews/completed_status", feed_preview: @feed_preview %>
  <% elsif @feed_preview.pending? || @feed_preview.processing? %>
    <%= render "feed_previews/processing_status", feed_preview: @feed_preview %>
  <% elsif @feed_preview.failed? %>
    <%= render "feed_previews/failed_status", feed_preview: @feed_preview %>
  <% end %>
</div>
